{% extends 'base.html' %}
{% load static %}

{% block title %}Cashier Page{% endblock %}

{% block content %}

    <div class="container">
        <h1>Update Transaction</h1>
        <div class="row">
            <div class="col-md-6">
                <!-- Image column -->
                <img src="../../{{ image_url }}" class="img-fluid" alt="YOLOv5 Output">
            </div>
            <div class="col-md-6">
        <form method="post" action="{% url 'transaction' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="{{ form.user.auto_id }}">User</label>
                <select class="form-control select2" name="{{ form.user.html_name }}" id="{{ form.user.auto_id }}">
                    {% for user in users %}
                        <option value="{{ user.pk }}" {% if form.user.value == user.pk %}selected{% endif %}>{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>

            {% for position_classified in positions_classified %}
                <div class="form-group">
                    <label for="position_{{ forloop.counter }}">Position {{ forloop.counter }}</label>
                    <select class="form-control select2 position-dropdown" name="positions" id="position_{{ forloop.counter }}" data-price="{{ position_classified.price }}">
                        {% for position in positions %}
                            <option value="{{ position.pk }}" data-price="{{ position.price }}" {% if position_classified.name == position.name %}selected{% endif %}>{{ position.name }} - {{ position.price }}</option>
                        {% endfor %}
                    </select>
                </div>
            {% endfor %}

            <div class="form-group">
                <label for="{{ form.total_check.auto_id }}">{{ form.total_check.label }}</label>
                <input type="number" class="form-control" id="{{ form.total_check.auto_id }}" name="{{ form.total_check.html_name }}" value="{{ form.total_check.value }}" readonly>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="{{ form.is_paid.auto_id }}" name="{{ form.is_paid.html_name }}" {% if form.is_paid.value %}checked{% endif %}>
                <label class="form-check-label" for="{{ form.is_paid.auto_id }}">
                    {{ form.is_paid.label }}
                </label>
            </div>
            <button type="submit" class="btn btn-primary">Save</button>
        </form>
    </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
    $('.select2').select2();

    function updateTotalCheck() {
        let totalCheck = 0;
        $('.position-dropdown').each(function() {
            totalCheck += parseInt($(this).find('option:selected').data('price'));
        });
        $('#{{ form.total_check.auto_id }}').val(totalCheck);
    }

    // Calculate the initial total check value
    updateTotalCheck();

    // Update the total check value when a position dropdown is changed
    $('.position-dropdown').on('change', function() {
        updateTotalCheck();
    });
});
    </script>
{% endblock %}